# analyzer-job.yaml (ìˆ˜ì •ë¨)
apiVersion: batch/v1
kind: Job
metadata:
  name: elf-analyzer-job
spec:
  template:
    spec:
      # ğŸ’¡ imagePullSecretsì™€ serviceAccountNameì´ ë°”ë¡œ ì´ ìœ„ì¹˜ì— ì¶”ê°€ë©ë‹ˆë‹¤.
      imagePullSecrets:
      - name: harbor-creds
      serviceAccountName: elf-analyzer-sa

      containers:
      - name: analyzer
        # 2ë‹¨ê³„ì—ì„œ ë¹Œë“œí•˜ê³  í‘¸ì‹œí•œ ì´ë¯¸ì§€ ì£¼ì†Œ
        image: shkch.duckdns.org/elf_analyzer/elf-analyzer:latest
        
        # main.goì˜ os.Args[1]ë¡œ ì „ë‹¬ë  ì¸ì
        args:
          - "/syscalltest2" 
          
        env:
          # 1. config.goì˜ LoadRedisAddr()ê°€ ì‚¬ìš©í•  ì£¼ì†Œ
          - name: CCSL_REDIS_ADDR
            value: "redis-ccsl-svc:6379"
            
          # 2. config.goì˜ LoadRedisPassword()ê°€ ì‚¬ìš©í•  ë¹„ë°€ë²ˆí˜¸
          - name: CCSL_REDIS_PASSWORD
            valueFrom:
              secretKeyRef:
                name: redis-ccsl-secret
                key: redis-password
                
      # Jobì´ ì‹¤íŒ¨í•˜ë©´ ì¬ì‹œë„í•˜ì§€ ì•ŠìŒ (ë˜ëŠ” OnFailure)
      restartPolicy: Never
  backoffLimit: 1 # ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ íšŸìˆ˜   